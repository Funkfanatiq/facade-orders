<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</title>
  <style>
    body { margin: 0; background: #f9f9f9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; color: #333; }
    .top-bar {
      background: #fff;
      padding: 16px 20px;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .top-bar h1 { margin: 0; font-size: 22px; font-weight: 600; }
    .back-link { color: #1976D2; text-decoration: none; font-weight: 500; }
    .back-link:hover { text-decoration: underline; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    .card-block {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      border: 1px solid #eee;
    }
    .card-block h3 { margin: 0 0 16px 0; font-size: 18px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 8px; }
    .card-block dl { margin: 0; display: grid; grid-template-columns: 180px 1fr; gap: 8px 20px; }
    .card-block dt { margin: 0; color: #666; font-weight: 500; }
    .card-block dd { margin: 0; }
    table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f5f5f5; font-weight: 600; color: #555; font-size: 14px; }
    .row-green { background-color: #f1f8e9; }
    .row-warning { background-color: #fff8e1; }
    .row-danger { background-color: #ffebee; }
    .empty-orders { color: #666; padding: 20px; text-align: center; background: #fff; border-radius: 8px; border: 1px dashed #ddd; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>üë§ {{ counterparty.name }}</h1>
    <a href="{{ url_for('dashboard') }}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏ –∑–∞–∫–∞–∑–æ–≤</a>
  </div>

  <div class="container">
    <div class="card-block">
      <h3>–û –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–µ</h3>
      <dl>
        <dt>–ò–º—è</dt><dd>{{ counterparty.name }}</dd>
        <dt>–¢–µ–ª–µ—Ñ–æ–Ω</dt><dd>{{ counterparty.phone or '‚Äî' }}</dd>
        <dt>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å</dt><dd>{{ counterparty.email or '‚Äî' }}</dd>
      </dl>
    </div>

    <div class="card-block">
      <h3>–†–µ–∫–≤–∏–∑–∏—Ç—ã</h3>
      <dl>
        <dt>–¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</dt><dd>{{ counterparty.counterparty_type or '‚Äî' }}</dd>
        <dt>–ò–ù–ù</dt><dd>{{ counterparty.inn or '‚Äî' }}</dd>
        <dt>–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</dt><dd>{{ counterparty.full_name or '‚Äî' }}</dd>
        <dt>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</dt><dd>{{ counterparty.legal_address or '‚Äî' }}</dd>
        <dt>–ö–æ–¥ –§–ò–ê–°</dt><dd>{{ counterparty.fias_code or '‚Äî' }}</dd>
        <dt>–ö–ü–ü</dt><dd>{{ counterparty.kpp or '‚Äî' }}</dd>
        <dt>–û–ì–†–ù</dt><dd>{{ counterparty.ogrn or '‚Äî' }}</dd>
        <dt>–û–ö–ü–û</dt><dd>{{ counterparty.okpo or '‚Äî' }}</dd>
        <dt>–ë–ò–ö</dt><dd>{{ counterparty.bik or '‚Äî' }}</dd>
        <dt>–ë–∞–Ω–∫</dt><dd>{{ counterparty.bank or '‚Äî' }}</dd>
        <dt>–ê–¥—Ä–µ—Å</dt><dd>{{ counterparty.address or '‚Äî' }}</dd>
        <dt>–ö–æ—Ä—Ä. —Å—á—ë—Ç</dt><dd>{{ counterparty.corr_account or '‚Äî' }}</dd>
        <dt>–†–∞—Å—á—ë—Ç–Ω—ã–π —Å—á—ë—Ç</dt><dd>{{ counterparty.payment_account or '‚Äî' }}</dd>
      </dl>
    </div>

    <div class="card-block">
      <h3>–¢–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã</h3>
      {% if orders %}
      <table>
        <thead>
          <tr>
            <th>‚Ññ –∑–∞–∫–∞–∑–∞</th>
            <th>–ö–ª–∏–µ–Ω—Ç</th>
            <th>–°—Ä–æ–∫</th>
            <th>–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞</th>
            <th>–®–ª–∏—Ñ–æ–≤–∫–∞</th>
            <th>–£–ø–∞–∫–æ–≤–∫–∞</th>
            <th>–û—Ç–≥—Ä—É–∑–∫–∞</th>
            <th>–û–ø–ª–∞—Ç–∞</th>
            <th>–§–∞–π–ª—ã</th>
          </tr>
        </thead>
        <tbody>
          {% for o in orders %}
            {% set days_left = (o.due_date - datetime.utcnow().date()).days %}
            {% set row_class = "" %}
            {% if o.packaging %} {% set row_class = "row-green" %}
            {% elif days_left <= 3 %} {% set row_class = "row-danger" %}
            {% elif days_left <= 6 %} {% set row_class = "row-warning" %}
            {% endif %}
            <tr class="{{ row_class }}">
              <td>{{ o.order_id }}</td>
              <td>{{ o.client }}</td>
              <td>{{ o.due_date.strftime('%Y-%m-%d') }}</td>
              <td>{{ "‚úî" if o.milling else "‚Äî" }}</td>
              <td>{{ "‚úî" if o.polishing_1 else "‚Äî" }}</td>
              <td>{{ "‚úî" if o.packaging else "‚Äî" }}</td>
              <td>{{ "‚úî" if o.shipment else "‚Äî" }}</td>
              <td>{{ "‚úî" if o.paid else "‚Äî" }}</td>
              <td>
                {% if o.filenames %}
                  {% for fn in o.filenames.split(';') %}
                    {% if fn %}
                      <a href="{{ url_for('uploaded_file', filename=fn) }}" target="_blank">üìé {{ fn }}</a><br>
                    {% endif %}
                  {% endfor %}
                {% else %}‚Äî
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="empty-orders">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –ø–æ —ç—Ç–æ–º—É –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É.</p>
      {% endif %}
    </div>
  </div>
</body>
</html>
